<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AI Chat Assistant</title>
    <meta name="description" content="Chat with multiple AI models including Claude, GPT-4o, Gemini, and DeepSeek">
    <meta name="theme-color" content="#7c3aed">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AI Chat">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        accent: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'shimmer': 'shimmer 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-2px)' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        }
                    },
                    backdropBlur: {
                        xs: '2px',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Fira Code', 'Monaco', 'Consolas', 'monospace'],
                    },
                    boxShadow: {
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'soft-lg': '0 10px 40px -10px rgba(0, 0, 0, 0.1)',
                        'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
                        'glow': '0 0 20px rgba(124, 58, 237, 0.3)',
                        'glow-lg': '0 0 40px rgba(124, 58, 237, 0.2)',
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    
    <!-- Custom responsive styles -->
    <link rel="stylesheet" href="responsive.css">
    
    <!-- PWA and iOS optimizations -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <style>
        /* Modern CSS Variables */
        :root {
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 40px rgba(124, 58, 237, 0.15);
        }
        
        /* Glass morphism effects */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Modern scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #5a6fd8, #6a4190);
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Modern button hover effects */
        .btn-modern {
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-modern:hover::before {
            left: 100%;
        }
        
        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        /* Gradient text */
        .gradient-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Modern card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-glow);
        }
        
        /* Loading shimmer effect */
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .dark .shimmer {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        
        /* Modern focus styles */
        .focus-modern:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.3);
        }
        
        /* Improved mobile touch targets */
        @media (max-width: 768px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Enhanced dark mode */
        .dark {
            --glass-bg: rgba(0, 0, 0, 0.2);
            --glass-border: rgba(255, 255, 255, 0.1);
        }
        
        /* Modern input styles */
        .input-modern {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .input-modern:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(124, 58, 237, 0.5);
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.2);
        }
        
        /* Pulse effect for active elements */
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(124, 58, 237, 0.6);
            }
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-slate-900 dark:to-indigo-950 font-sans antialiased">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-violet-600 via-purple-600 to-blue-600">
        <div class="text-center">
            <div class="relative">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                    <i class="fas fa-robot text-3xl text-white animate-bounce-subtle"></i>
                </div>
                <div class="absolute inset-0 w-20 h-20 mx-auto rounded-full border-4 border-white/30 border-t-white animate-spin"></div>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">AI Chat Assistant</h2>
            <p class="text-white/80">Initializing your AI experience...</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="flex h-full">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-80 transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0">
            <div class="flex flex-col h-full glass dark:glass-dark rounded-r-3xl lg:rounded-none shadow-soft-lg">
                <!-- Sidebar Header -->
                <div class="flex items-center justify-between p-6 border-b border-white/10">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-soft">
                            <i class="fas fa-robot text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold gradient-text">AI Chat</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Your AI Assistant</p>
                        </div>
                    </div>
                    <button id="close-sidebar" class="lg:hidden p-2 rounded-xl hover:bg-white/10 transition-colors touch-target">
                        <i class="fas fa-times text-gray-600 dark:text-gray-300"></i>
                    </button>
                </div>

                <!-- New Chat Button -->
                <div class="p-4">
                    <button id="new-chat" class="w-full btn-modern bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-2xl shadow-soft hover:shadow-glow transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>
                        New Chat
                    </button>
                </div>

                <!-- Model Selection -->
                <div class="px-4 pb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI Model</label>
                    <div class="relative">
                        <select id="model-selector" class="w-full input-modern rounded-xl py-3 px-4 text-sm focus-modern appearance-none cursor-pointer">
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro</option>
                            <option value="deepseek-chat">DeepSeek Chat</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <!-- Settings -->
                <div class="px-4 pb-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Dark Mode</label>
                        <button id="dark-mode-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-violet-600 transition-colors focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2">
                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform dark:translate-x-6"></span>
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Speed Mode</label>
                        <button id="speed-mode-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2">
                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Technical Mode</label>
                        <button id="technical-mode" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2">
                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                        </button>
                    </div>
                </div>

                <!-- Chat History -->
                <div class="flex-1 overflow-hidden">
                    <div class="px-4 pb-2">
                        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Recent Chats</h3>
                    </div>
                    <div id="chat-history" class="px-2 space-y-1 overflow-y-auto custom-scrollbar max-h-96">
                        <!-- Chat history items will be populated here -->
                    </div>
                </div>

                <!-- Footer Actions -->
                <div class="p-4 border-t border-white/10 space-y-2">
                    <button id="keyboard-shortcuts-btn" class="w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-white/10 rounded-xl transition-colors">
                        <i class="fas fa-keyboard mr-2"></i>
                        Keyboard Shortcuts
                    </button>
                    <button id="export-chat-btn" class="w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-white/10 rounded-xl transition-colors">
                        <i class="fas fa-download mr-2"></i>
                        Export Chat
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-h-0 lg:ml-0">
            <!-- Header -->
            <header class="glass dark:glass-dark border-b border-white/10 px-4 py-3 lg:px-6 lg:py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button id="toggle-sidebar" class="lg:hidden p-2 rounded-xl hover:bg-white/10 transition-colors touch-target">
                            <i class="fas fa-bars text-gray-600 dark:text-gray-300"></i>
                        </button>
                        <div class="hidden lg:block">
                            <h2 class="text-xl font-bold gradient-text">AI Chat Assistant</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Powered by multiple AI models</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button id="search-toggle" class="p-2 rounded-xl hover:bg-white/10 transition-colors touch-target">
                            <i class="fas fa-search text-gray-600 dark:text-gray-300"></i>
                        </button>
                        <button id="history-toggle" class="p-2 rounded-xl hover:bg-white/10 transition-colors touch-target">
                            <i class="fas fa-history text-gray-600 dark:text-gray-300"></i>
                        </button>
                        <div class="relative">
                            <button id="more-options" class="p-2 rounded-xl hover:bg-white/10 transition-colors touch-target">
                                <i class="fas fa-ellipsis-v text-gray-600 dark:text-gray-300"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Search Bar (Hidden by default) -->
            <div id="message-search" class="hidden glass dark:glass-dark border-b border-white/10 p-4">
                <div class="relative">
                    <input type="text" placeholder="Search messages..." class="w-full input-modern rounded-xl py-3 px-4 pl-10 focus-modern">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass dark:glass-dark border-b border-white/10 p-4">
                <div id="quick-actions" class="flex space-x-2 overflow-x-auto custom-scrollbar pb-2">
                    <button data-action="explain-code" class="btn-modern whitespace-nowrap px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all transform hover:scale-105">
                        <i class="fas fa-code mr-2"></i>Explain Code
                    </button>
                    <button data-action="debug-code" class="btn-modern whitespace-nowrap px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-xl hover:bg-red-200 dark:hover:bg-red-900/50 transition-all transform hover:scale-105">
                        <i class="fas fa-bug mr-2"></i>Debug Code
                    </button>
                    <button data-action="optimize-code" class="btn-modern whitespace-nowrap px-4 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-xl hover:bg-green-200 dark:hover:bg-green-900/50 transition-all transform hover:scale-105">
                        <i class="fas fa-tachometer-alt mr-2"></i>Optimize
                    </button>
                    <button data-action="research-summary" class="btn-modern whitespace-nowrap px-4 py-2 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-xl hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-all transform hover:scale-105">
                        <i class="fas fa-book mr-2"></i>Research
                    </button>
                    <button data-action="math-solution" class="btn-modern whitespace-nowrap px-4 py-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-xl hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition-all transform hover:scale-105">
                        <i class="fas fa-calculator mr-2"></i>Math
                    </button>
                </div>
            </div>

            <!-- Chat Container -->
            <div id="chat-container" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-6">
                <!-- Welcome Screen -->
                <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center animate-fade-in">
                    <div class="float-animation mb-8">
                        <div class="w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-violet-500 via-purple-600 to-blue-600 flex items-center justify-center shadow-glow-lg">
                            <i class="fas fa-robot text-4xl text-white"></i>
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold gradient-text mb-4">Welcome to AI Chat</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-8 max-w-md">
                        Start a conversation with advanced AI models. Ask questions, get help with code, research topics, or just chat!
                    </p>
                    
                    <!-- Example Prompts -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full">
                        <button class="example-prompt card-hover glass dark:glass-dark p-6 rounded-2xl text-left shadow-soft hover:shadow-glow transition-all">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-code text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800 dark:text-gray-200">Code Help</h3>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Explain this JavaScript function and suggest improvements</p>
                        </button>
                        
                        <button class="example-prompt card-hover glass dark:glass-dark p-6 rounded-2xl text-left shadow-soft hover:shadow-glow transition-all">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-lightbulb text-green-600 dark:text-green-400"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800 dark:text-gray-200">Creative Writing</h3>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Help me write a compelling story about space exploration</p>
                        </button>
                        
                        <button class="example-prompt card-hover glass dark:glass-dark p-6 rounded-2xl text-left shadow-soft hover:shadow-glow transition-all">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-graduation-cap text-purple-600 dark:text-purple-400"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800 dark:text-gray-200">Learning</h3>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Explain quantum computing in simple terms</p>
                        </button>
                        
                        <button class="example-prompt card-hover glass dark:glass-dark p-6 rounded-2xl text-left shadow-soft hover:shadow-glow transition-all">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-chart-line text-orange-600 dark:text-orange-400"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800 dark:text-gray-200">Analysis</h3>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Analyze current trends in artificial intelligence</p>
                        </button>
                    </div>
                </div>

                <!-- Messages will be inserted here -->
            </div>

            <!-- Input Area -->
            <div class="glass dark:glass-dark border-t border-white/10 p-4">
                <form id="chat-form" class="relative">
                    <div class="flex items-end space-x-3">
                        <!-- Attachment Button -->
                        <button type="button" id="attachment-btn" class="flex-shrink-0 p-3 rounded-xl hover:bg-white/10 transition-colors touch-target">
                            <i class="fas fa-paperclip text-gray-500 dark:text-gray-400"></i>
                        </button>
                        
                        <!-- Input Field -->
                        <div class="flex-1 relative">
                            <textarea 
                                id="user-input" 
                                placeholder="Type your message here..." 
                                class="w-full input-modern rounded-2xl py-4 px-6 pr-16 resize-none focus-modern min-h-[56px] max-h-32"
                                rows="1"
                            ></textarea>
                            
                            <!-- Send Button -->
                            <button 
                                type="submit" 
                                id="send-button"
                                class="absolute right-2 bottom-2 w-12 h-12 btn-modern bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 text-white rounded-xl shadow-soft hover:shadow-glow transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <!-- Voice Input Button -->
                        <button type="button" id="voice-input-btn" class="flex-shrink-0 p-3 rounded-xl hover:bg-white/10 transition-colors touch-target">
                            <i class="fas fa-microphone text-gray-500 dark:text-gray-400"></i>
                        </button>
                    </div>
                    
                    <!-- Character Count -->
                    <div class="flex justify-between items-center mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <span id="char-count">0 characters</span>
                        <span class="flex items-center space-x-2">
                            <span>Press Ctrl+Enter to send</span>
                        </span>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Scroll to Bottom Button -->
    <button id="scroll-to-bottom" class="fixed bottom-24 right-6 w-12 h-12 btn-modern bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-full shadow-glow hover:shadow-glow-lg transition-all transform hover:scale-110 opacity-0 pointer-events-none z-30">
        <i class="fas fa-arrow-down"></i>
    </button>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"></div>

    <!-- Popup Helper -->
    <div id="popup-helper" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass dark:glass-dark rounded-3xl p-8 m-4 max-w-md w-full shadow-glow-lg animate-scale-in">
            <div class="text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-2xl text-white"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Allow Popups</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">
                    Please allow popups for this site to enable AI chat functionality. This is required for authentication with AI services.
                </p>
                <button id="popup-helper-close" class="btn-modern bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl shadow-soft hover:shadow-glow transition-all">
                    Got it
                </button>
            </div>
        </div>
    </div>

    <!-- File input for attachments -->
    <input type="file" id="file-input" class="hidden" accept="image/*,.pdf,.txt,.doc,.docx" multiple>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    
    <!-- Custom Scripts -->
    <script src="keyboard-shortcuts.js"></script>
    <script src="code-execution.js"></script>
    <script src="technical-prompt-utils.js"></script>
    <script src="modules/custom-prompts.js"></script>
    <script src="research-utils.js"></script>
    <script src="app.js"></script>

    <script>
        // Initialize loading screen
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen after a short delay
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }, 1500);

            // Initialize modern UI features
            initializeModernUI();
        });

        function initializeModernUI() {
            // Auto-resize textarea
            const userInput = document.getElementById('user-input');
            if (userInput) {
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 128) + 'px';
                    
                    // Update character count
                    const charCount = document.getElementById('char-count');
                    if (charCount) {
                        charCount.textContent = `${this.value.length} characters`;
                    }
                });
            }

            // Sidebar toggle functionality
            const toggleSidebar = document.getElementById('toggle-sidebar');
            const closeSidebar = document.getElementById('close-sidebar');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');

            function openSidebar() {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('opacity-0', 'pointer-events-none');
            }

            function closeSidebarFn() {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0', 'pointer-events-none');
            }

            if (toggleSidebar) toggleSidebar.addEventListener('click', openSidebar);
            if (closeSidebar) closeSidebar.addEventListener('click', closeSidebarFn);
            if (overlay) overlay.addEventListener('click', closeSidebarFn);

            // Search toggle
            const searchToggle = document.getElementById('search-toggle');
            const messageSearch = document.getElementById('message-search');
            
            if (searchToggle && messageSearch) {
                searchToggle.addEventListener('click', () => {
                    messageSearch.classList.toggle('hidden');
                    if (!messageSearch.classList.contains('hidden')) {
                        messageSearch.querySelector('input').focus();
                    }
                });
            }

            // Example prompts
            const examplePrompts = document.querySelectorAll('.example-prompt');
            examplePrompts.forEach(prompt => {
                prompt.addEventListener('click', () => {
                    const text = prompt.querySelector('p').textContent;
                    if (userInput) {
                        userInput.value = text;
                        userInput.focus();
                        userInput.dispatchEvent(new Event('input'));
                    }
                });
            });

            // Modern toggle switches
            initializeToggleSwitches();

            // Scroll to bottom functionality
            initializeScrollToBottom();
        }

        function initializeToggleSwitches() {
            const toggles = [
                { id: 'dark-mode-toggle', key: 'dark_mode' },
                { id: 'speed-mode-toggle', key: 'speed_mode' },
                { id: 'technical-mode', key: 'technical_mode' }
            ];

            toggles.forEach(({ id, key }) => {
                const toggle = document.getElementById(id);
                if (toggle) {
                    const isEnabled = localStorage.getItem(key) === 'true';
                    updateToggleState(toggle, isEnabled);

                    toggle.addEventListener('click', () => {
                        const newState = !toggle.classList.contains('bg-violet-600');
                        updateToggleState(toggle, newState);
                        localStorage.setItem(key, newState.toString());

                        // Handle dark mode
                        if (id === 'dark-mode-toggle') {
                            document.documentElement.classList.toggle('dark', newState);
                        }
                    });
                }
            });
        }

        function updateToggleState(toggle, isEnabled) {
            const span = toggle.querySelector('span');
            if (isEnabled) {
                toggle.classList.add('bg-violet-600');
                toggle.classList.remove('bg-gray-200');
                span.classList.add('translate-x-6');
            } else {
                toggle.classList.remove('bg-violet-600');
                toggle.classList.add('bg-gray-200');
                span.classList.remove('translate-x-6');
            }
        }

        function initializeScrollToBottom() {
            const scrollBtn = document.getElementById('scroll-to-bottom');
            const chatContainer = document.getElementById('chat-container');

            if (scrollBtn && chatContainer) {
                chatContainer.addEventListener('scroll', () => {
                    const isNearBottom = chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - 100;
                    
                    if (isNearBottom) {
                        scrollBtn.classList.add('opacity-0', 'pointer-events-none');
                    } else {
                        scrollBtn.classList.remove('opacity-0', 'pointer-events-none');
                    }
                });

                scrollBtn.addEventListener('click', () => {
                    chatContainer.scrollTo({
                        top: chatContainer.scrollHeight,
                        behavior: 'smooth'
                    });
                });
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>